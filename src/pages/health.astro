---
import ReturnHome from "$components/controls/ReturnHome.astro"
import Layout from "../layouts/Layout.astro"

const pageTitle = "My health"
---

<Layout title={pageTitle}>
	<section>
		<h1>{pageTitle}</h1>
		<p>
			Some tools to maintain good habits. I don't want to obsess over my health, but I do want to
			stay healthy enough to fully enjoy life.
		</p>
		<p>
			Based on the strongest scientific literature, there are several habits that can significantly
			improve my health: daily physical activity, regular sleep schedules, a balanced diet,<sup
				>1</sup
			> no tobacco, little to none alcohol,<sup>2</sup> avoiding air pollution,<sup>3</sup> reducing
			UV exposure, up-to-date vaccinations and screenings, quality social relationships, and managing
			stress. Everything else tends to be marginal, marketing scams, or not relevant for me.<side-note
				class="xl:-mt-16"
				>1 — A diverse and mostly plant-based diet, with enough protein, fiber, and healthy fats. I
				don't want to avoid all salty, processed, and sugary foods as long as they stay occasional.
				And I don't believe in strict diets that are hard to maintain, guilt-inducing, and often not
				backed by science.</side-note
			><side-note
				>2 — I don't smoke, but I do drink alcohol occasionally—usually just a glass of wine in
				social settings, or lonkero after sauna.</side-note
			><side-note
				>3 — I currently live in Toulouse, France, which has a good to moderate air quality. But I
				plan to move to Helsinki, Finland, in the near future, which has excellent to good air
				quality.</side-note
			>
		</p>
		<ReturnHome />
	</section>
	<section>
		<h2>Daily tracking</h2>
		<p>
			My daily steps, sleep, and energy levels—tracked with my Galaxy Watch Ultra and Samsung Health
			app. I want to walk at least 7,500 steps a day, sleep 7 hours, and keep my energy above 75%.
			Weekly averages are more important than daily values.
		</p>
		<div id="health-month">
			<p>Loading...</p>
		</div>
	</section>
	<script>
		import type { Day as ApiDay } from "./api/health/health"
		import { HealthMonth } from "../components/health/HealthMonth"
		import type { Day } from "../components/health/day"

		async function loadHealth() {
			const container = document.getElementById("health-month")
			if (!container) return

			container.innerHTML = "<p>Loading...</p>"

			try {
				const res = await fetch("/api/health/health")
				if (!res.ok) throw new Error(`HTTP ${res.status}`)
				const { days } = (await res.json()) as { days: ApiDay[] }

				const parsed: Day[] = days.map((d) => ({
					date: new Date(d.date),
					steps: d.steps,
					sleep: d.sleep,
					energy: d.energy,
				}))

				if (!parsed.length) {
					container.innerHTML = "<p>No data available.</p>"
					return
				}

				const monthName = parsed[0].date.toLocaleString("en-US", {
					month: "long",
					year: "numeric",
				})

				const month = new HealthMonth().setData({
					month: monthName,
					comment: "",
					days: parsed,
				})

				container.replaceChildren(month)
			} catch (err) {
				console.error("Failed to load health data:", err)
				container.innerHTML = "<p>Failed to load data.</p>"
			}
		}

		document.addEventListener("DOMContentLoaded", loadHealth)
	</script>
</Layout>
